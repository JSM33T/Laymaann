{"version":3,"sources":["../../../../../Scripts/dedicated/account/recovery.ts"],"sourcesContent":["import { User } from '../../Interfaces/user.interface.js';\r\ndeclare const bootstrap: any;\r\n\r\n\r\nimport { acToast, acPostData, acFormHandler, acInit } from '../../global.js';\r\n\r\nconst userNameInput = document.getElementById('userName') as HTMLInputElement;\r\nconst submitBtn = document.getElementById('recSubmitBtn') as HTMLButtonElement;\r\n\r\n//modal props\r\nconst otpModal = new bootstrap.Modal(document.getElementById('otpMdl'));\r\nconst otpSubmit = document.getElementById(\"submitOtp\") as HTMLButtonElement;\r\nconst otpVal = document.getElementById(\"otpVal\") as HTMLInputElement;\r\n\r\n\r\nacInit([\r\n    () => acFormHandler('recovery-form', submitUserName),\r\n    () => acFormHandler('otp-form', recoverAccount)\r\n]);\r\n\r\n\r\nasync function submitUserName() {\r\n    if (userNameInput.value.trim().length <= 1) {\r\n        acToast(\"error\", \"Username too short\");\r\n    } else {\r\n        await postToLoginApi(userNameInput.value);\r\n    }\r\n}\r\n\r\nasync function postToLoginApi(usernameval: string) {\r\n    try {\r\n        const response = await acPostData('/api/account/recover', {\r\n            userName: usernameval\r\n        });\r\n        console.log(response);\r\n        acToast(response.type, response.data);\r\n\r\n        if (response.type === \"ok\") {\r\n            const lastLink: string | null = localStorage.getItem(\"curr_link\");\r\n            otpModal!.show();\r\n        }\r\n    } catch (error) {\r\n        console.error('Error during login:', error);\r\n        acToast('error', 'Something went wrong');\r\n    } finally {\r\n        submitBtn.innerHTML = \"Recover\";\r\n    }\r\n}\r\n\r\nconst recoverAccount = async function () {\r\n\r\n    otpSubmit.innerHTML = \"Wait...\";\r\n    otpSubmit.classList.add('pe-none');\r\n    console.log(otpVal.value);\r\n    try {\r\n        const dt = {\r\n            OTP: otpVal.value.trim(),\r\n        }\r\n        const response = await acPostData(\"/api/account/loginviaotp\", dt);\r\n        console.log(response);\r\n        if (response.type === \"ok\") {\r\n            otpModal!.hide();\r\n            acToast(\"success\", \"Logging into your acc. Make sure to set your password\");\r\n            setTimeout(\r\n                redirect,\r\n                2000\r\n            );\r\n        }\r\n        else {\r\n            console.log(\"error\", response.data);\r\n            acToast(\"error\", \"Invalid OTP\");\r\n        }\r\n    } catch (error) {\r\n        console.error('Error during login:', error);\r\n        acToast('error', 'something went wrong');\r\n    } finally {\r\n        otpSubmit.innerHTML = \"Verify\";\r\n        otpSubmit.classList.remove('pe-none');\r\n    }\r\n};\r\n\r\n\r\nconst redirect = () => window.location.href = \"/\";\r\n"],"names":["acToast","acPostData","acFormHandler","acInit","userNameInput","document","getElementById","submitBtn","otpModal","bootstrap","Modal","otpSubmit","otpVal","submitUserName","value","trim","length","postToLoginApi","usernameval","response","userName","console","log","type","data","localStorage","getItem","show","error","innerHTML","recoverAccount","classList","add","dt","OTP","hide","setTimeout","redirect","remove","window","location","href"],"mappings":"2TAIA,OAASA,WAAAA,CAAO,CAAEC,cAAAA,CAAU,CAAEC,iBAAAA,CAAa,CAAEC,UAAAA,CAAM,KAAQ,iBAAkB,CAE7E,IAAMC,EAAgBC,SAASC,cAAc,CAAC,YACxCC,EAAYF,SAASC,cAAc,CAAC,gBAGpCE,EAAW,IAAIC,UAAUC,KAAK,CAACL,SAASC,cAAc,CAAC,WACvDK,EAAYN,SAASC,cAAc,CAAC,aACpCM,EAASP,SAASC,cAAc,CAAC,mBASxBO,WAAAA,iCAAAA,WAAAA,EAAf,EAAA,YACQT,EAAcU,KAAK,CAACC,IAAI,GAAGC,MAAM,EAAI,EACrChB,EAAQ,QAAS,sBAEjB,MAAMiB,SAIgBC,CAAmB,SAAlCD,yBAJcb,EAAcU,KAAK,CAEhD,mCAEeG,WAAAA,EAAf,EAAA,UAA8BC,CAAmB,EAC7C,GAAI,CACA,IAAMC,EAAW,MAAMlB,EAAW,uBAAwB,CACtDmB,SAAUF,CACd,GACAG,QAAQC,GAAG,CAACH,GACZnB,EAAQmB,EAASI,IAAI,CAAEJ,EAASK,IAAI,EAEd,OAAlBL,EAASI,IAAI,GACmBE,aAAaC,OAAO,CAAC,aACrDlB,EAAUmB,IAAI,GAEtB,CAAE,MAAOC,EAAO,CACZP,QAAQO,KAAK,CAAC,sBAAuBA,GACrC5B,EAAQ,QAAS,uBACrB,QAAU,CACNO,EAAUsB,SAAS,CAAG,SAC1B,CACJ,0BAhCA1B,EAAO,CACH,IAAMD,EAAc,gBAAiBW,GACrC,IAAMX,EAAc,WAAY4B,GACnC,EA+BD,IAAMA,KAAiB,EAAA,YAEnBnB,EAAUkB,SAAS,CAAG,UACtBlB,EAAUoB,SAAS,CAACC,GAAG,CAAC,WACxBX,QAAQC,GAAG,CAACV,EAAOE,KAAK,EACxB,GAAI,CACA,IAAMmB,EAAK,CACPC,IAAKtB,EAAOE,KAAK,CAACC,IAAI,EAC1B,EACMI,EAAW,MAAMlB,EAAW,2BAA4BgC,GAC9DZ,QAAQC,GAAG,CAACH,GACRA,AAAkB,OAAlBA,EAASI,IAAI,EACbf,EAAU2B,IAAI,GACdnC,EAAQ,UAAW,yDACnBoC,WACIC,EACA,OAIJhB,QAAQC,GAAG,CAAC,QAASH,EAASK,IAAI,EAClCxB,EAAQ,QAAS,eAEzB,CAAE,MAAO4B,EAAO,CACZP,QAAQO,KAAK,CAAC,sBAAuBA,GACrC5B,EAAQ,QAAS,uBACrB,QAAU,CACNW,EAAUkB,SAAS,CAAG,SACtBlB,EAAUoB,SAAS,CAACO,MAAM,CAAC,UAC/B,CACJ,+CAGMD,EAAW,IAAME,OAAOC,QAAQ,CAACC,IAAI,CAAG"}