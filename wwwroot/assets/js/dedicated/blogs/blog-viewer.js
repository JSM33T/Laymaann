function t(t,e,n,l,o,a,i){try{var s=t[a](i),c=s.value}catch(t){n(t);return}s.done?e(c):Promise.resolve(c).then(l,o)}function e(e){return function(){var n=this,l=arguments;return new Promise(function(o,a){var i=e.apply(n,l);function s(e){t(i,o,a,s,c,"next",e)}function c(e){t(i,o,a,s,c,"throw",e)}s(void 0)})}}import{acToast as n,acInit as l,acPostData as o,acFormHandler as a,acGetData as i,classesToTagsWDiv as s}from"../../global.js";let c=document.getElementById("ip_slug"),r=document.getElementById("ip_tags"),d=document.getElementById("likesStat"),u=document.getElementById("likeIcon"),p=document.getElementById("likeBtn"),m=document.getElementById("ip_blogrole"),y=document.getElementById("blogCount"),g=document.getElementById("commentsHolder"),f=new bootstrap.Modal(document.getElementById("mdlDelete")),h=document.getElementById("delConfirm"),b=new bootstrap.Modal(document.getElementById("mdlEdit")),v=document.getElementById("saveChanges"),I=new bootstrap.Modal(document.getElementById("mdlReply")),E=document.getElementById("saveReply"),L=c.value,B=r.value;function S(){return(S=e(function*(){let t=document.querySelectorAll(".deletecontent"),e=document.querySelectorAll(".editcontent"),n=document.querySelectorAll(".replyto");t.forEach(function(t){t.addEventListener("click",function(){let e=t.dataset.contentid;(function(t,e){F.apply(this,arguments)})(t.dataset.type,e)})}),e.forEach(function(t){t.addEventListener("click",function(){let e=t.dataset.contentid;(function(t,e){N.apply(this,arguments)})(t.dataset.type,e)})}),n.forEach(function(t){t.addEventListener("click",function(){let e=t.dataset.contentid;e&&function(t){D.apply(this,arguments)}(e)})}),console.log("delete events attached")})).apply(this,arguments)}function $(){return k.apply(this,arguments)}function k(){return(k=e(function*(){let t=yield o("/api/blog/likestat",{slug:L}),e=t.data;"ok"==t.type?!0==e?(u.classList.remove("ai-heart"),u.classList.add("ai-heart-filled")):(u.classList.remove("ai-heart-filled"),u.classList.add("ai-heart")):console.log("notliked + error")})).apply(this,arguments)}function M(){return x.apply(this,arguments)}function x(){return(x=e(function*(){let t=yield i("/api/blog/"+L+"/likes");console.log(t),"ok"==t.type?d.innerHTML=t.data:d.innerHTML="0"})).apply(this,arguments)}function T(){return H.apply(this,arguments)}function H(){return(H=e(function*(){console.log((yield o("/api/blog/addlike",{Slug:L}))),M(),$()})).apply(this,arguments)}function w(){return(w=e(function*(){try{let t=yield i("/api/blog/"+L+"/authors");if("ok"===t.type){let e=t.data,n="";if(0!==e.length){for(let t=0;t<e.length;t++)n+='<a href="/author/'+e[t].userName+'" class="no-decor">'+e[t].firstName+" "+e[t].lastName+"</a>, ";document.getElementById("authorsPlaceholder").innerHTML=n.slice(0,n.lastIndexOf(","))+n.slice(n.lastIndexOf(",")+1)}}else console.error("Error:",t.data),document.getElementById("authorsPlaceholder").innerHTML="--"}catch(t){console.error("Error:",t),document.getElementById("authorsPlaceholder").innerHTML="--"}})).apply(this,arguments)}function C(){return P.apply(this,arguments)}function P(){return(P=e(function*(){let t=document.getElementById("blog_comment");if(t.value.length<2)n("error","comment too short");else{let e=document.getElementById("commentbutton");e.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>posting.. ',e.classList.add("pe-none");let l={Slug:L,Comment:t.value},a=yield o("/api/blog/comment/add",l);try{n(a.type,a.data),e.innerHTML="Post Comment",_(),e.classList.remove("pe-none"),t.value=""}catch(t){console.log("catch block"+t)}finally{e.innerHTML="Post Comment",e.classList.remove("pe-none")}}})).apply(this,arguments)}function _(){return R.apply(this,arguments)}function R(){return(R=e(function*(){let t=m.value,e=yield o("/api/blog/comments/load",{Slug:L});console.log(e);let n="",l=0;if(0==e.data.length)n="";else for(let o=0;o<e.data.length;o++){let a=e.data[o];if(l=o+1,n+=`<div class="border-bottom py-4 mt-2 mb-4">
                                <div class="d-flex align-items-center pb-1 mb-3">
                                    <img class="rounded-circle" src="/assets/images/avatars/default/${a.avatar}.png" width="48" alt="Comment author">
                                    <div class="ps-3">
                                        <h6 class="mb-0">${a.fullname}</h6><span class="fs-sm text-muted">${a.date}</span>
                                    </div>
                                </div>
                                <div class="btn-group-sm me-2 ml-2 mx-2" style="float:right;" role="group" aria-label="Settings group">
                                    ${"guest"!==t?`<button type="button" data-contentid="${a.id}" class="replyto btn btn-secondary btn-icon px-2"><i class="ai-redo"></i></button>&nbsp;`:""}
                                    ${a.edit?`<button type="button" data-type="comment" data-contentid="${a.id}" class="editcontent btn btn-secondary btn-icon px-2"><i class="ai-edit"></i></button>&nbsp;`:""}
                                    ${a.edit?`<button type="button" data-type="comment" data-contentid="${a.id}" class="deletecontent btn btn-secondary btn-icon px-2"><i class="ai-trash"></i></button>&nbsp;`:""}
                                </div>
                                <span class="pb-2 mb-0" id="comment_${a.id}">${a.comment}</span>
                            </div>
                            `,a.replies&&a.replies.length>0){a.replies.sort((t,e)=>t.replyId-e.replyId);for(let t=0;t<a.replies.length;t++){let e=a.replies[t];n+=`   <div class="card card-body border-0 bg-secondary mt-4">
                                <div class="d-flex align-items-center pb-1 mb-3">
                                    <img class="rounded-circle" src="/assets/images/avatars/default/${e.replyAvatar}.png" width="48" alt="Comment author">
                                    <div class="ps-3">
                                        <h6 class="mb-0">${e.replyFullName}</h6><span class="fs-sm text-muted">${e.replyDate}</span>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center justify-content-between mb-3" role="group" aria-label="Settings group">
                                    <p class="mb-0"><a class="fw-bold text-decoration-none" href="#">@${a.username}</a>&nbsp;&nbsp;<span id="reply_${e.replyId}">${e.replyComment}</span></p>
                                    <div>
                                        ${e.replyEdit?`<button type="button" data-type="reply" data-contentid="${e.replyId}" data-action="edit" class="editcontent btn btn-sm btn-secondary btn-icon px-2"><i class="ai-edit"></i></button>&nbsp;`:""}
                                        ${e.replyEdit?`<button type="button" data-type="reply" data-contentid="${e.replyId}" class="deletecontent btn btn-sm btn-secondary btn-icon px-2"><i class="ai-trash"></i></button>&nbsp;`:""}
                                    </div>
                                </div>
                            </div>
                            `}}n+="</div>"}g.innerHTML=n,y.innerHTML=l.toString(),function(){S.apply(this,arguments)}()})).apply(this,arguments)}function A(){return(A=e(function*(){var t=B.split(","),e="";t.forEach(function(t){for(var n=t.split(" "),l=0;l<n.length;l++)e+=`<a class="btn btn-outline-secondary btn-sm rounded-pill mt-2 ms-2" href="/blogs/tag/${n[l]}">${n[l]}</a>`}),document.getElementById("tagsPlaceholder").innerHTML=e})).apply(this,arguments)}function N(){return(N=e(function*(t,e){let n=document.getElementById("editIp"),l="";"comment"==t?l="comment_"+e:"reply"==t&&(l="reply_"+e);let o=document.getElementById(l);o&&(n.value=o.innerHTML,console.log(o.innerHTML)),localStorage.setItem("type",t),localStorage.setItem("contentid",e),b.show()})).apply(this,arguments)}function q(){return j.apply(this,arguments)}function j(){return(j=e(function*(){let t=document.getElementById("editIp"),e=localStorage.getItem("contentid"),n=localStorage.getItem("type"),l={Id:e,comment:t.value},a=yield o("/api/blog/"+n+"/edit",l);console.log(l),console.log(a),yield _(),b.hide()})).apply(this,arguments)}function D(){return(D=e(function*(t){localStorage.setItem("action","reply"),localStorage.setItem("contentid",t),I.show()})).apply(this,arguments)}function O(){return z.apply(this,arguments)}function z(){return(z=e(function*(){let t=localStorage.getItem("contentid"),e=document.getElementById("txtarReply");console.log(t+"\n"+e.value);try{let l=yield o("/api/blog/reply/add",{CommentId:null==t?void 0:t.trim(),ReplyText:e.value.trim(),Reply:e.value.trim()});n("Success",l.data)}catch(t){n("error","something went wrong")}finally{I.hide(),e.value="",_()}})).apply(this,arguments)}function F(){return(F=e(function*(t,e){let n=document.getElementById("mdlContentType");"comment"==t?(n.innerHTML="comment",f.show()):"reply"==t&&(n.innerHTML="reply",f.show()),localStorage.setItem("content-type",t),localStorage.setItem("content-id",e),localStorage.setItem("action","delete")})).apply(this,arguments)}function G(){return J.apply(this,arguments)}function J(){return(J=e(function*(){if("delete"==localStorage.getItem("action")){let t=localStorage.getItem("content-type"),e=localStorage.getItem("content-id");if("comment"==t){let t=yield o("/api/blog/comment/delete",{id:e});f.hide(),n("Success",t.data)}else if("reply"==t){let t=yield o("/api/blog/reply/delete",{replyid:e});f.hide(),n("Success",t.data)}}_(),localStorage.removeItem("action")})).apply(this,arguments)}l([function(){return A.apply(this,arguments)},function(){return w.apply(this,arguments)},M,$,_,()=>p.addEventListener("click",T),()=>s("blogBody","img","size-image"),()=>a("comment-form",C),()=>h.addEventListener("click",G),()=>E.addEventListener("click",O),()=>v.addEventListener("click",q)]);
//# sourceMappingURL=blog-viewer.js.map